# azure.yaml
name: ai-starter-postgres
infra:
  path: ./infra
services:
  api:
    project: ./server
    language: js
    host: containerapp
    docker:
      path: ./server/Dockerfile
      context: ./server
    environmentVariables:
      - PORT=4000

  web:
    project: ./client
    language: js
    host: staticwebapp
    dist: dist
    hooks:
      prepackage:
        windows:
          shell: pwsh
          run: |
            echo "VITE_API_URL=\"$Env:API_URL\"" > .env.local
        posix:
          shell: sh
          run: |
            echo "VITE_API_URL=\"$API_URL\"" > .env.local
      postdeploy:
        windows:
          shell: pwsh
          run: rm .env.local
        posix:
          shell: sh
          run: rm .env.local